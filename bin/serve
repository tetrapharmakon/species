#!/usr/bin/env bash
set -euo pipefail

# Wrapper to run `bundle exec jekyll serve` inside the Nix devShell when needed.
# Usage: ./bin/serve [jekyll args...]

# If bundler can find the gems locally, run directly.
if command -v bundle >/dev/null 2>&1 && bundle check >/dev/null 2>&1; then
  exec bundle exec jekyll serve "$@"
fi

# Otherwise, if nix is available, run jekyll inside the devShell without Bundler.
if command -v nix >/dev/null 2>&1; then
  exec nix develop --command jekyll serve "$@"
fi

cat <<'EOF' >&2
Error: could not run `jekyll serve`.
- bundler couldn't find the gems (run `bundle install`), and
- nix is not available to enter the devShell (run `nix develop` first).

Options:
- Install gems locally: run `bundle install --path vendor/bundle` and retry.
- Enter the Nix dev shell: run `nix develop` then `bundle exec jekyll serve`.
- Use this wrapper: `./bin/serve` (requires `bash`).
EOF

exit 1
